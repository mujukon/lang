<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>翻訳演習</title>
<style>
#question {
  font-size: 50px;
}
button {
  margin: 10px;
  font-size: 50px;
  background-color: #fefefe;
  border: 2px solid #ddd;
  border-radius: 20px;
  box-shadow: 2px 1px 2px gray
  }
#answerBox {
  min-height: 30px;
  border: 1px solid #aaa;
  padding: 6px;
  margin: 8px 0;
  font-size: 50px;
}
#modeSelect {
  font-size: 50px;
}
#bottomBar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 10px;
  display: flex;
  justify-content: center;
  gap: 10px;
  background: white;
  border-top: 1px solid #ccc;
  z-index: 10;
}

#bottomBar button {
  font-size: 50px;
  padding: 30px 16px;
}

.correct { 
  color: green; 
         font-size: 50px;
}
.wrong { 
  color: red; 
       font-size: 50px;}
</style>
</head>
<body

<h2>翻訳演習</h2>

<select id="modeSelect">
  <option value="jp2lang">日本語 → 外国語</option>
  <option value="lang2jp">外国語 → 日本語</option>
</select>

<div id="question"></div>

<div id="answerBox"></div>
<div id="wordButtons"></div>

<div id="langSelect">
  <div id="langButtons"></div>
  <button id="langNext">➝</button>
</div>

<button id="backBtn">← 単語削除</button>

<div id="bottomBar">
  <button id="backLangBtn">言語選択に戻る</button>
  <button id="checkBtn">答え合わせ</button>
  <button id="nextBtn" style="display:none;">次へ</button>
</div>



<div id="result"></div>

<script src="data.js"></script>


</body>
</html>
<script>
  let index = 0;
let currentWords = [];
let correctAnswers = [];
let poolJP = [];
let poolLang = [];
let buttons = [];
let mistake = -1;
let phase = "lang"; // "lang" or "quiz"

const blocks = sentenceText.split("*");

const langs = [];
const sentencesByLang = [];

let state = {
  lang: 0
};


blocks.forEach(block => {
  block = block.trim();
  if (!block) return;

  const lines = block.split("\n").filter(l => l.trim() !== "");

  const langName = lines[0].trim(); // 言語名
  langs.push(langName);

  const sentences = lines.slice(1); // 例文部分
  sentencesByLang.push(sentences);
});


/* ===== 単語プール構築（言語別） ===== */
function buildWordPool() {
  const setJP = new Set();
  const setLang = new Set();

  const sentences = sentencesByLang[state.lang];

  sentences.forEach(line => {
    const [lang, jpRaw] = line.split("\t");
    const jps = jpRaw.split("/");

    lang.split(" ").forEach(w => setLang.add(w));
    jps.forEach(j => j.split(" ").forEach(w => setJP.add(w)));
  });

  poolJP = [...setJP];
  poolLang = [...setLang];
}



/* ===== 問題生成 ===== */


function loadQuestion() {
 if (phase == "quiz"){
  const sentences = sentencesByLang[state.lang];

  currentWords = [];
  buttons = [];

  document.getElementById("result").textContent = "";
  document.getElementById("answerBox").textContent = "";
  document.getElementById("wordButtons").innerHTML = "";
  document.getElementById("checkBtn").style.display = "inline";
  document.getElementById("nextBtn").style.display = "none";

  const mode = document.getElementById("modeSelect").value;

  const line = sentences[index % sentences.length];
  const [lang, jpRaw] = line.split("\t");
  const jps = jpRaw.split("/");

  let questionText, answers, pool;

  if (mode === "jp2lang") {
    questionText = jps[0];
    answers = [lang];
    pool = poolLang;
  } else {
    questionText = lang;
    answers = jps;
    pool = poolJP;
  }

  correctAnswers = answers;

  document.getElementById("question").innerHTML =
    "【" + langs[state.lang] + "】 <br>" + questionText;

  // 正解単語
  let words = new Set();
  answers.forEach(ans => ans.split(" ").forEach(w => words.add(w)));

  // ダミー単語（同じ言語側のみ）
  while (words.size < Math.min(pool.length, 12)) {
    const w = pool[Math.floor(Math.random() * pool.length)];
    words.add(w);
  }

  words = Array.from(words).sort(() => Math.random() - 0.5);

  const area = document.getElementById("wordButtons");

  words.forEach(word => {
    const btn = document.createElement("button");
    btn.textContent = word;

    btn.onclick = () => {
      currentWords.push(word);
      btn.style.display = "none"; // 消す
      buttons.push(btn);
      updateAnswer();
    };

    area.appendChild(btn);
  });
 }
}


/* ===== 解答表示 ===== */

function updateAnswer() {
  document.getElementById("answerBox").textContent = currentWords.join(" ");
}


/* ===== 単語削除（ボタン復活） ===== */

document.getElementById("backBtn").onclick = () => {
  if (currentWords.length === 0) return;

  const removed = currentWords.pop();

  // 消えたボタンを復活
  const btn = buttons.find(b => b.textContent === removed && b.style.display === "none");
  if (btn) btn.style.display = "";

  updateAnswer();
};


/* ===== 判定 ===== */

document.getElementById("nextBtn").onclick = () => {
  if (mistake == -1){
    const sentences = sentencesByLang[state.lang]
    index = Math.floor(Math.random() * sentences.length);
  }
  currentWords = [];
  loadQuestion();
};

document.getElementById("checkBtn").onclick = () => {
  const userAnswer = currentWords.join(" ");
  const ok = correctAnswers.includes(userAnswer);

  const result = document.getElementById("result");

  if (ok) {
    result.textContent = "✅ 正解";
    result.className = "correct";
    mistake = -1;
  } else {
    mistake = 1;
    result.textContent = "❌ 不正解 / 正解: " + correctAnswers.join(" / ");
    result.className = "wrong";
  }

  document.getElementById("checkBtn").style.display = "none";
  document.getElementById("nextBtn").style.display = "inline";
};


/* ===== 次へ ===== */


document.getElementById("modeSelect").onchange = loadQuestion;

let langPage = 0;

function updateLangButtons() {
  const base = langPage * 3;
  const area = document.getElementById("langButtons");
  area.innerHTML = "";
  
  for (let i = 0; i < langs.length; i++) {
    const idx = base + i;
    if (!langs[idx]) continue;

    const btn = document.createElement("button");
    btn.textContent = langs[idx];
    btn.onclick = () => {
      state.lang = idx;
      buildWordPool();
      const sentences = sentencesByLang[state.lang]
      index = Math.floor(Math.random() * sentences.length);
      loadQuestion();
      selectLanguage(idx);
    };
    area.appendChild(btn);
  }
}

document.getElementById("langNext").onclick = () => {
  langPage = (langPage + 1) % Math.ceil(langs.length / 3);
  updateLangButtons();
};

document.getElementById("backLangBtn").onclick = () => {
  phase = "lang";

  // 言語選択UI表示
  document.getElementById("langSelect").style.display = "block";

  // クイズUIはそのままでもOKだけど、消したければ：
  document.getElementById("question").textContent = "";
  document.getElementById("answerBox").textContent = "";
  document.getElementById("wordButtons").innerHTML = "";
  document.getElementById("result").textContent = "";

  // 戻るボタン非表示
  document.getElementById("backLangBtn").style.display = "none";
};
function selectLanguage(idx) {
  state.lang = idx;
  phase = "quiz";
  const sentences = sentencesByLang[state.lang]
  index = Math.floor(Math.random() * sentences.length);
  buildWordPool();
  loadQuestion();

  // 言語選択UIを消す
  document.getElementById("langSelect").style.display = "none";

  // 戻るボタン表示
  document.getElementById("backLangBtn").style.display = "inline";

  
}

updateLangButtons();


</script>






